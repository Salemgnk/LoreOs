# ============================================================
# LoreOS — Docker Compose (dev)
# Usage : docker compose up
# ============================================================

services:
  # ── Backend FastAPI ──────────────────────────────────
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    volumes:
      # Hot reload : le code local est monté dans le container
      - ./backend:/app
      # Éviter d'écraser les deps installées dans le container
      - /app/__pycache__
    env_file:
      - ./backend/.env
    environment:
      - APP_ENV=development
      - CORS_ORIGINS=http://localhost:3000
    restart: unless-stopped

  # ── Frontend Next.js ─────────────────────────────────
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      # Hot reload : le code local est monté dans le container
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - ./frontend/next.config.js:/app/next.config.js
      - ./frontend/tailwind.config.js:/app/tailwind.config.js
      - ./frontend/postcss.config.js:/app/postcss.config.js
      # Ne PAS monter node_modules (sinon ça écrase ceux du container)
    env_file:
      - ./frontend/.env.local
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000
      - WATCHPACK_POLLING=true
    depends_on:
      - backend
    restart: unless-stopped
